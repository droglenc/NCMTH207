---
title: "Exercise Key"
subtitle: "SLR Inference"
author: Derek H. Ogle
layout: page
css: "/css/modules.css"
output:
  html_document:
    fig_height: 3.5
    fig_width: 3.5
    self_contained: false
---

```{r echo=FALSE, eval=FALSE, warning=FALSE}
## Renders an appropriate HTML file and moves to CE directory
source("modules/ce/aaaKeys/zzz_modHTML_CEKeys.R")
modHTML_CEKeys("KEY_SLRInference_CE1")
```

```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
library(NCStats)
source("../../../rhelpers/knitr_setup.R")

br <- data.frame(year=1970:1990,
                 propmale=c(0.5134,0.5126,0.5125,0.5128,0.5133,0.5132,0.5128,
                            0.5128,0.5129,0.5127,0.5129,0.5126,0.5123,0.5127,
                            0.5122,0.5126,0.5122,0.5120,0.5121,0.5120,0.5120))
lm.br <- lm(propmale~year,data=br)
sum.br <- summary(lm.br)
syx.br <- sum.br$sigma
cf.br <-coef(lm.br)
ci.br <- confint(lm.br)
r2.br <- rSquared(lm.br)
```

----

<div class="alert alert-warning">
<strong>Note:</strong> 
<ul>
  <li>Any question about a "relationship" or "rate of change" will use some result about the slope. Questions of "significance" will use the slope p-value. Descriptions of the relationship will use the slope's confidence interval.</li>
  <li>When interpreting a negative slope, remove the negative and say "decreases." Also flip your CI values so that it reads from the smallest value to the largest value.</li>
  <li>Predictions of individuals use a prediction interval, whereas predictions of means for all individuals use a confidence interval.</li>
  <li>Be thoughtful about your number of decimals ... for means you generally only need 1 or 2 decimals more than the way the data were recorded ... for p-values no more than 4 decimals is necessary.</li>
  </ol>
</ul>
</div>

----

# Male-Female Birth Ratio

1. The variance of observations about the best-fit line is $S_{Y|X}^{2}$=`r formatC(syx.br^2,format="f",digits=9)`.
1. There is a statistical change in the proportion of male births in the U.S. over the study period because the slope is significantly less than 0 (`r kPvalue(sum.br$coefficients["year","Pr(>|t|)"],latex=FALSE,digits=6)`). This slope would be how much the proportion of males changes per year. Thus, if it is less than zero then the proportion of of males is decreasing.
1. The proportion of males is decreasing at a rate between `r formatC(-1*ci.br[2,2],format="f",digits=6)` and `r formatC(-1*ci.br[2,1],format="f",digits=6)` per year, on average.
1. The p-value is so small even though the slope value is so small because the SE of the slope is even smaller. The SE of the slope is so small because the variability about the line is small and the overall scale of the proportion of males value is very small. The small p-value comes from a large t and the large t comes from the slope being much larger than the SE of the slope.

### R Code and Results.
```{r eval=FALSE}
br <- read.csv("BirthRatio.csv")
```
```{r prompt=FALSE}
lm.br <- lm(propmale~year,data=br)
cbind(Est=coef(lm.br),confint(lm.br))
summary(lm.br)
```

&nbsp;

# Willow Flycatcher Migration

```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
wfc <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/Flycatcher.csv")
lm.wfc <- lm(winglen~date,data=wfc)
sum.wfc <- summary(lm.wfc)
cf.wfc <-coef(lm.wfc)
ci.wfc <- confint(lm.wfc)
pi.160 <- predict(lm.wfc,data.frame(date=160),interval="prediction")
ci.160 <- predict(lm.wfc,data.frame(date=160),interval="confidence")
```

1. There is a relationsip between wing length and data of migration because the slope is significantly less than 0 (`r kPvalue(sum.wfc$coefficients["date","Pr(>|t|)"],latex=FALSE)`).
1. The slope (i.e., the relationship) means that for every increase of one day that the wing length decreases by between `r formatC(-1*ci.wfc[2,2],format="f",digits=3)` and `r formatC(-1*ci.wfc[2,1],format="f",digits=3)` mm, on average.
1. The predicted wing length for a bird that migrated on day 160 is between `r formatC(pi.160[1,"lwr"],format="f",digits=1)` and `r formatC(pi.160[1,"upr"],format="f",digits=1)` mm. This is about a bird, so this uses a "prediction interval."
1. The predicted mean wing length for all birds that migrated on day 160 is between `r formatC(ci.160[1,"lwr"],format="f",digits=1)` and `r formatC(ci.160[1,"upr"],format="f",digits=1)` mm. This is about all birds, so this uses a "confidence interval."
1. The prediction interval is wider because it needs to account for variability in placing the line and variability of individuals around the line, whereas the confidence interval is only concerned with variability in placement of the line.

### R Code and Results.
```{r prompt=FALSE}
wfc <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/Flycatcher.csv")
lm.wfc <- lm(winglen~date,data=wfc)
cbind(Est=coef(lm.wfc),confint(lm.wfc))
summary(lm.wfc)
predict(lm.wfc,data.frame(date=160),interval="prediction")
predict(lm.wfc,data.frame(date=160),interval="confidence")
```

&nbsp;

# Car Horsepower and Gas Mileage
```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
gas <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/CarMPG.csv")
lm.gas <- lm(mpg~hp,data=gas)
sum.gas <- summary(lm.gas)
cf.gas <-coef(lm.gas)
ci.gas <- confint(lm.gas)
pi.125 <- predict(lm.gas,data.frame(hp=125),interval="prediction")
ci.110 <- predict(lm.gas,data.frame(hp=110),interval="confidence")
ci.1256 <- predict(lm.gas,data.frame(hp=c(125,126)),interval="confidence")
```

1. There is a significant relationship between mpg and horsepower because the slope is significantly less than 0 (`r kPvalue(sum.gas$coefficients["hp","Pr(>|t|)"],latex=FALSE)`).
1. The slope (i.e., the relationship) means that for every increase of one horsepower that the mpg decreases by between `r formatC(-1*ci.gas[2,2],format="f",digits=3)` and `r formatC(-1*ci.gas[2,1],format="f",digits=3)`, on average.
1. The predicted mean mpg for all makes of car with horsepower of 110 is between `r formatC(ci.110[1,"lwr"],format="f",digits=1)` and `r formatC(ci.110[1,"upr"],format="f",digits=1)`. This is about all makes of cars, so this uses a "confidence interval."
1. The predicted mpg for a make of car with a horsepower of 125 is between `r formatC(pi.125[1,"lwr"],format="f",digits=1)` and `r formatC(pi.125[1,"upr"],format="f",digits=1)` mm. This is about a car, so this uses a "prediction interval."
1. The predicted mpg for makes of cars with horsepowers of 125 and 126 is `r formatC(ci.1256[1,"fit"],format="f",digits=3)` and `r formatC(ci.1256[2,"fit"],format="f",digits=3)`, respectively. Horsepowers of 125 and 126 represent an increase of one horsepower, so the difference between the two predictions (=`r formatC(ci.1256[2,"fit"],format="f",digits=3)`-`r formatC(ci.1256[1,"fit"],format="f",digits=3)`=`r formatC(ci.1256[2,"fit"]-ci.1256[1,"fit"],format="f",digits=3)`) is the same as the slope (`r formatC(cf.gas[2],format="f",digits=3)`).
1. The graphic is shown below.

### R Code and Results.
```{r prompt=FALSE}
gas <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/CarMPG.csv")
lm.gas <- lm(mpg~hp,data=gas)
cbind(Est=coef(lm.gas),confint(lm.gas))
summary(lm.gas)
predict(lm.gas,data.frame(hp=125),interval="prediction")
predict(lm.gas,data.frame(hp=110),interval="confidence")
predict(lm.gas,data.frame(hp=c(125,126)),interval="confidence")
ggplot(data=gas,mapping=aes(x=hp,y=mpg)) +  
  geom_point(pch=21,color="black",fill="lightgray") +  
  labs(x="Horsepower",y="Miles per Gallon") +  
  theme_NCStats() +  
  geom_smooth(method="lm")
```
