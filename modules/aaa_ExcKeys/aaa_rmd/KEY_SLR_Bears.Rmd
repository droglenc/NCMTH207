---
title: "Exercise Key"
subtitle: "Simple Linear Regression"
author: Derek H. Ogle
layout: page
css: "/css/modules.css"
output:
  html_document:
    fig_height: 3.5
    fig_width: 3.5
    self_contained: false
---

```{r echo=FALSE, eval=FALSE, warning=FALSE}
## Renders an appropriate HTML file and moves to CE directory
source("modules/aaa_ExcKeys/aaa_rmd/zzz_modHTML_CEKeys.R")
modHTML_CEKeys("KEY_SLR_Bears")
```

```{r echo=FALSE, results='hide', fig.show='hide', message=FALSE, warning=FALSE}
library(NCStats)
source("../../../rhelpers/knitr_setup.R")

bb <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/BlackBears.csv")
bb <- filterD(bb,age>1)
lm1 <- lm(weight~length,data=bb)
ad1 <- adTest(lm1$residuals)
out1 <- outlierTest(lm1)
bb$logw <- log(bb$weight)
bb$logl <- log(bb$length)
lm2 <- lm(logw~logl,data=bb)
ad2 <- adTest(lm2$residuals)
out2 <- outlierTest(lm2)
aov2 <- anova(lm2)
sum2 <- summary(lm2)
ci2 <- confint(lm2)
lens <- c(130,160,190)
nd <- data.frame(logl=log(lens))
p.logw <- predictionPlot(lm2,nd,interval="p")
p.weight <- cbind(obs=1:3,exp(p.logw[,3:5])*exp(anova(lm2)[2,3]/2))

library(captioner)
tbls <- captioner(prefix="Table")
figs <- captioner(prefix="Figure")
tbls(name="aov","ANOVA table for the linear regression of log-transformed weight on log-transformed length of Florida Black Bears.")
tbls(name="preds","Weights (back-transformed) for Florida Black Bears of various lengths (130, 160, and 190 cm) as predicted from the linear regression of log-transformed weight on log-transformed length.")
figs(name="residPlot1","Histogram of residuals (left) and residual plot (right) for regression of weight on length of Florida Black Bears.")
figs(name="residPlot2","Histogram of residuals (left) and residual plot (right) for regression of log-transformed weight on log-transformed length of Florida Black Bears.")
figs(name="fitplot","Scatterplot of log-transformed weight on log-transformed length of Florida Black Bears with best-fit line.")
```

----

<div class="alert alert-warning">
<strong>Note:</strong> 
<ul>
  <li>There are no "groups" in simple linear regression; thus, you do not assess "within-" and "among-group" independence here.</li>
  <li>You should begin to use the ANOVA table p-value rather than the summary table slope p-value to assess the relationship as this will generalize to the next module.</li>
  <li>When describing the relationship, use the confidence interval for the slope. Don't just use the slope.</li>
  <li>When back-transforming the slope to describe the relationship on the original scale, note that "a change in log(x) of 1" should be back-transformed to "a change in x of e<sup>1</sup>" which is where the 2.72 in answer 4 below came from. Also, note that the back-transformed slope indicates a "multiplicative" change such that the value is Y is multiplied by the back-transformed slope rather than added to.
  <li>The predictions should use prediction intervals as the original authors were interested in predicting the weight of an individual bear.</li>
</ul>
</div>

----

## Black Bear Weight
1. It is difficult to ultimately assess independence with the amount of information given. However, under the assumption that all Black Bears were unique (no bear was measured twice) then it seems that the data are at least roughly independent. There is evidence for a strong non-linearity and heteroscedasticity (`r figs("residPlot1",display="cite")`-Right). The residuals do not appear to be normal (Anderson Darling `r kPvalue(ad1$p,digits=4,latex=FALSE)`) and are right-skewed (`r figs("residPlot1",display="cite")`-Left). No significant outliers are evident (outlier test `r kPvalue(out1$bonf.p,digits=4,latex=FALSE)`). A transformation will be explored to see if the assumptions can be met.

1. Weight-length relationships tend to follow a power function which suggests that both the weight and lengths should be transformed to the natural log scale. With this transformation there is no visual evidence for non-linearity (`r figs("residPlot1",display="cite")`-Right), the residuals appeared homoscedastic (`r figs("residPlot1",display="cite")`-Right) and normal (Anderson-Darling `r kPvalue(ad2$p,digits=4,latex=FALSE)`; `r figs("residPlot1",display="cite")`-Left), and there is no evidence for significant outliers (outlier test `r kPvalue(out2$bonf.p,digits=4,latex=FALSE)`). Thus, the assumptions appear to be adequately met on the log-log scale.

1. There is a signficant relationship between the log weight and log length of Florida Black Bears (`r kPvalue(aov2[1,"Pr(>F)"],digits=4,latex=FALSE)`; `r tbls("aov",display="cite")`;  `r figs("fitplot",display="cite")`).

1. Specifically, as the log length of the Black Bears increases by one unit, the average log weight increases between `r formatC(ci2["logl",1],format="f",digits=3)` and `r formatC(ci2["logl",2],format="f",digits=3)` units. On the original scale, as the length of the Black Bear increases by a multiple of `r formatC(exp(1),format="f",digits=2)` cm, the average weight changes (increases) by a multiple of between `r formatC(exp(ci2["logl",1]),format="f",digits=1)` and `r formatC(exp(ci2["logl",2]),format="f",digits=1)`.

1. The predicted weight, corrected for back-transformation bias, for three different lengths is shown in `r tbls("preds",display="cite")`. For example, the predicted weight for a 130 cm long Florida Black Bear is between `r formatC(p.weight[1,"lwr"],format="f",digits=1)` and `r formatC(p.weight[1,"upr"],format="f",digits=1)` kg.

&nbsp;


```{r echo=FALSE, fig.width=7, fig.height=3.5, par1=TRUE}
NCStats:::iAssumPlot_REGRESS(NCStats:::iTypeoflm(lm1),
                             lambday=1,shifty=0,lambdax=1,shiftx=0,
                             show.stats=TRUE,alpha=0.05,col.hist="gray70")
```

`r figs("residPlot1")`

```{r echo=FALSE, fig.width=7, fig.height=3.5, par1=TRUE}
NCStats:::iAssumPlot_REGRESS(NCStats:::iTypeoflm(lm1),
                             lambday=0,shifty=0,lambdax=0,shiftx=0,
                             show.stats=TRUE,alpha=0.05,col.hist="gray70")
```

`r figs("residPlot2")`

```{r echo=FALSE, fig.width=3.5, fig.height=3.5, par1=TRUE}
fitPlot(lm2,xlab="Log(Length (cm))",ylab="Log(Weight (kg))")
```

`r figs("fitplot")`

`r tbls("aov")`

```{r echo=FALSE,background="white"}
kANOVA(lm1)
```

`r tbls("preds")`

```{r echo=FALSE,background="white"}
print(p.weight,row.names=FALSE)
```

R Appendix.
```{r eval=FALSE, prompt=FALSE}
bb <- read.csv("BlackBears.csv")
bb <- filterD(bb,age>1)
lm1 <- lm(weight~length,data=bb)
transChooser(lm1)
bb$logw <- log(bb$weight)
bb$logl <- log(bb$length)
lm2 <- lm(logw~logl,data=bb)
transChooser(lm2)
anova(lm2)
cbind(Ests=coef(lm2),confint(lm2))
lens <- c(130,160,190)
nd <- data.frame(logl=log(lens))
p.logw <- predictionPlot(lm2,nd,interval="prediction")
p.weight <- exp(p.logw[,3:5])*exp(anova(lm2)[2,3]/2)
```

----
