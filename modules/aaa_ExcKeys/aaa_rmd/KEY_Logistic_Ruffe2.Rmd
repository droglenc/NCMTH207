---
title: "Exercise Key"
subtitle: "Logistic Regression"
author: Derek H. Ogle
layout: page
css: "/css/modules.css"
output:
  html_document:
    fig_height: 3.5
    fig_width: 3.5
    self_contained: false
---

```{r echo=FALSE, eval=FALSE, warning=FALSE}
## Renders an appropriate HTML file and moves to CE directory
source("modules/aaa_ExcKeys/aaa_rmd/zzz_modHTML_CEKeys.R")
modHTML_CEKeys("KEY_Logistic_Ruffe2")
```

```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
library(NCStats)
source("../../../rhelpers/knitr_setup.R")

df <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/RuffeLarvalDiet.csv")
glm1 <- glm(o.daph~len*loc,data=df,family=binomial)
cf1 <- coef(glm1)
sum1 <- summary(glm1)
p6 <- predict(glm1,data.frame(len=c(6,6),loc=c("Allouez","Whaleback")),type="response")

glm2 <- glm(o.bosm~len*loc,data=df,family=binomial)
cf2 <- coef(glm2)
sum2 <- summary(glm2)
p6b <- predict(glm2,data.frame(len=c(6,6),loc=c("Allouez","Whaleback")),type="response")

library(captioner)
tbls <- captioner(prefix="Table")
figs <- captioner(prefix="Figure")
tbls(name="sum1","Summary of the coefficients from the logistic regression of whether or not a larval Ruffe had consumed a <i>Daphnia</i> and the length of the Ruffe by location.")
tbls(name="sum2","Summary of the coefficients from the logistic regression of whether or not a larval Ruffe had consumed a <i>Bosmina</i> and the length of the Ruffe by location.")
```

----

<div class="alert alert-warning">
<strong>Note:</strong> 
<ul>
  <li>XXX</li>
</ul>
</div>

----

## Ruffe Feeding II

1. The ultimate full model for the logistic regression of the occurrence of *Daphnia* by larval Ruffe length between the two locations is log($\frac{p}{1-p}$) = &alpha; + &beta;LENGTH + &delta;<sub>1</sub>WB + &gamma;<sub>1</sub>WB&times;LENGTH, where p is the probability of having a *Daphnia* in the stomach, LENGTH is the length of the larval Ruffe, and WB is 1 if the Ruffe is from Whaleback Bay and 0 if from Allouez Bay.

1. The meanings of the parameters in the ultimate full model are as follows:
    * &alpha; is the intercept for Allouez Bay
    * &beta; is the slope for Allouez Bay
    * &delta;<sub>1</sub> is the difference in intercepts between Whaleback Bay and Allouez Bay
    * &gamma;<sub>1</sub> is the difference in slopes between Whaleback Bay and Allouez Bay

1. There is a significant difference in the relationship between the probability of having consumed a *Daphnia* and the length of the larval Ruffe as the p-value for the difference in slopes (`r kPvalue(sum1$coefficients[4,4],digits=4,latex=FALSE)`; `r tbls("sum",display="cite")`) is less than 0.05.

1. The probabilities that a 6-mm long larval Ruffe had consumed a *Daphnia* is `r formatC(p6[[1]],format="f",digits=4)` for Allouez Bay and `r formatC(p6[[2]],format="f",digits=4)` for Whaleback Bay.


1. There is no significant difference in the relationship between the probability of having consumed a *Bosmina* and the length of the larval Ruffe as the p-value for the difference in slopes (`r kPvalue(sum2$coefficients[4,4],digits=4,latex=FALSE)`; `r tbls("sum",display="cite")`) is greater than 0.05. In addition, the intercepts do not differ between the groups (`r kPvalue(sum2$coefficients[3,4],digits=4,latex=FALSE)`; `r tbls("sum",display="cite")`). Thus, the probabily of having consumed a *Bosmina* and the length of the larval Ruffe is modeled by the same line for Ruffe from both Allouez and Whaleback Bays.

1. The probabilities that a 6-mm long larval Ruffe had consumed a *Bosmina* is `r formatC(p6b[[1]],format="f",digits=4)` for Allouez Bay and `r formatC(p6b[[2]],format="f",digits=4)` for Whaleback Bay. Note that these probabilities are not significantly different as both locations are modeled by the same line.

`r tbls("sum1")`

```{r echo=FALSE, background="white"}
sum1$coefficients
```


`r tbls("sum2")`

```{r echo=FALSE, background="white"}
sum2$coefficients
```


R Appendix.
```{r eval=FALSE, prompt=FALSE}
df <- read.csv("RuffeLarvalDiet.csv")
glm1 <- glm(o.daph~len*loc,data=df,family=binomial)
coef(glm1)
summary(glm1)
predict(glm1,data.frame(len=c(6,6),loc=c("Allouez","Whaleback")),type="response")

glm2 <- glm(o.bosm~len*loc,data=df,family=binomial)
coef(glm2)
summary(glm2)
predict(glm2,data.frame(len=c(6,6),loc=c("Allouez","Whaleback")),type="response")
```

----
