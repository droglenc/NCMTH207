---
layout: page
title: "One-Way ANOVA"
subtitle: R Handout
author: "Derek H. Ogle"
css: "/css/modules.css"
output:
  html_document:
    fig_height: 3
    fig_width: 3
    self_contained: no
  pdf_document:
    fig_width: 3
    fig_height: 3
---

```{r echo=FALSE, eval=FALSE}
# Renders an appropriate HTML file for the webpage (CTRL-ALT-C)
setwd("C:/aaaWork/Web/GitHub/NCMTH207/modules/Anova-1Way")
source("../../rhelpers/rhelpers.R")
modHTML("RHO")
```

```{r echo=FALSE, results='hide', message='FALSE'}
source("../../rhelpers/knitr_setup.R")
```

```{r results='hide', message=FALSE, warning=FALSE}
options(show.signif.stars=FALSE)
library(NCStats)
library(multcomp)     # for glht()
```

----

# Raspberry Example
A researcher is interested in the effect of irrigation on fruit production by raspberry plants. The researcher has determined that he will examine the effects of 100 ml (a maintenance amount), 200, 400, and 800 ml of water per pot. The researcher had 16 identical planting pots available and much more than that number of raspberry plant seedlings. A square table for growing the plants in a greenhouse is available. He had enough time to let the plants mature (i.e., produce berries) or not. At the end of this period, the total weight (g) of mature berries was recorded.

```{r}
setwd("C:/aaaWork/Web/GitHub/NCMTH207/modules/Anova-1Way")
rasp <- read.csv("Raspberry.csv")
str(rasp)
rasp$water <- factor(rasp$water)
str(rasp)
```

## Fitting the Linear Model
```{r results='hide'}
lm1 <- lm(weight~water,data=rasp)
anova(lm1)
```
```{r echo=FALSE}
kANOVA(lm1)
```

```{r}
cbind(Ests=coef(lm1),confint(lm1))
```

\newpage

```{r par1=TRUE}
fitPlot(lm1,xlab="Water Treatment (ml)",ylab="Weight (g)")
```


## Checking Assumptions
```{r eval=FALSE}
transChooser(lm1)
```

```{r echo=FALSE, out.width="6in"}
include_graphics("TCRasp1.jpg")
```

\newpage

## Multiple Comparison Tests
```{r results='hide'}
rasp.mc <- glht(lm1, mcp(water = "Tukey"))
summary(rasp.mc)
```
```{r echo=FALSE}
kGLHT(rasp.mc,type="hypothesis")
```

```{r results='hide'}
confint(rasp.mc)
```
```{r echo=FALSE}
kGLHT(rasp.mc,type="confidence")
```

```{r par1=TRUE}
fitPlot(lm1,xlab="Water Treatment (ml)",ylab="Weight (g)",main="")
addSigLetters(lm1,lets=c("a","a","b","b"),pos=c(2,4,2,4))
```

----

\newpage

# Benthic Infaunal Example
To examine the effect of effluent releases on benthic organisms in the release area, researchers recorded the total abundance of benthic organisms at eight haphazardly-selected sublocations at each of eight control locations (thought to have not been impacted by the effluent release) and one potentially impacted location. Use the data in `BenthicInfaunal.csv` to determine if the mean abundance of benthic organisms differs between the locations (and, especially, if the impacted location differs from any of the control locations).

```{r}
ben <- read.csv("BenthicInfaunal.csv")
ben$site <- factor(ben$site)
str(ben)
```

## Assumption Checking with Possible Transformations
```{r}
lm2 <- lm(abundance~site,data=ben)
```

```{r eval=FALSE}
transChooser(lm2)
```
```{r echo=FALSE, out.width="6in"}
include_graphics("TCBenthic1.jpg")
```

```{r eval=FALSE}
transChooser(lm2)  # interactively adjust lambdas
```
```{r echo=FALSE, out.width="6in"}
include_graphics("TCBenthic2.jpg")
```

```{r}
ben$logab <- log(ben$abundance)
lm3 <- lm(logab~site,data=ben)
```

## Model Summarization
```{r results='hide'}
anova(lm3)
```
```{r echo=FALSE}
kANOVA(lm3)
```

```{r results='hide'}
ben.mc <- glht(lm3, mcp(site = "Dunnett"))
summary(ben.mc)
```
```{r echo=FALSE}
kGLHT(ben.mc,type="hypothesis")
```

\newpage

```{r message=FALSE, par1=TRUE}
fitPlot(lm3,ylab="Log Abundance",xlab="Site",main="")
addSigLetters(lm3,lets=c("","","*","*","*","","","*",""),pos=c(2,4,2,4,2,2,4,2,4))
```

```{r results='hide'}
confint(ben.mc)
```
```{r echo=FALSE}
kGLHT(ben.mc,type="confidence")
```

```{r results='hide'}
exp(confint(ben.mc)$confint)
```
```{r echo=FALSE}
exp(kGLHT(ben.mc,type="confidence"))
```

```{r echo=FALSE, results="hide", message=FALSE, warnings=FALSE}
purl2("RHO.Rmd",moreItems=c("source","modHTML","kGLHT","kANOVA","include_graphics"))
```
