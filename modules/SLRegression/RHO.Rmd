---
title: "Simple Linear Regression"
subtitle: R Handout
author: "Derek H. Ogle"
layout: page
css: /css/modules.css
output:
  pdf_document:
    fig_height: 2.5
    fig_width: 2.5
  html_document:
    fig_height: 3
    fig_width: 3
    self_contained: no
---

```{r echo=FALSE, eval=FALSE}
# Renders an appropriate HTML file for the webpage
source("C:/aaaWork/Web/GitHub/NCMTH207/rhelpers/rhelpers.R")
setwd("C:/aaaWork/Web/GitHub/NCMTH207/modules/SLRegression") ## DELETE
modHTML("RHO")
```
```{r echo=FALSE, results='hide', message='FALSE'}
source("C:/aaaWork/Web/GitHub/NCMTH207/rhelpers/knitr_setup.R")
```

\vspace{-12pt}

----

\vspace{-12pt}

# Oak Gall Wasps

\vspace{-6pt}

[Prior and Hellman (2010)](http://www.esapubs.org/archive/ecol/E091/232/appendix-C.htm) investigated the impact of invasive Oak Gall Wasps (*Neuroterus saltatorius*) on a native butterfly. They hoped to use the amount of damage shown on oak leaves as a surrogate for the density of the wasps' galls. To examine this they recorded the density of wasp galls (number per leaf) and the percentage leaf damage for ten trees. Is leaf damage a reliable predictor of wasp gall density?
```{r results='hide', message=FALSE, warning=FALSE}
library(NCStats)
setwd("C:/aaaWork/Web/GitHub/NCMTH207/modules/SLRegression")
```

\vspace{-4pt}

```{r}
df <- read.csv("galls.csv")
str(df)
xlbl <- "Percentage of Leaf Damage"
ylbl <- "Wasp Gall Density"
```

## Lecture Support I -- Model Fitting and Simple Predictions

```{r message=FALSE, par1=TRUE}
( lm1 <- lm(density~damage,data=df) )
fitPlot(lm1,xlab=xlbl,ylab=ylbl)
predict(lm1,data.frame(damage=35))
```

## Lecture Support II -- Sampling Variability
```{r par1=TRUE}
summary(lm1)
confint(lm1)
fitPlot(lm1,interval="both",ylab=ylbl,xlab=xlbl,ylim=c(0,2000),xlim=c(0,60))
```

```{r par1=TRUE}
predict(lm1,data.frame(damage=35),interval="confidence")
predict(lm1,data.frame(damage=35),interval="prediction")
predictionPlot(lm1,data.frame(damage=c(13,35)),interval="confidence",
               ylab=ylbl,xlab=xlbl,ylim=c(0,2000),xlim=c(0,60))
```

## Lecture Support III -- Model Comparisons

```{r results="hide"}
anova(lm1)
```
```{r echo=FALSE}
tmp <- anova(lm2)
attr(tmp,"heading") <- NULL
tmp
```


## Lecture Support IV -- Assumption Checking

```{r eval=FALSE}
transChooser(lm1)
```
```{r echo=FALSE, out.width='6in'}
knitr::include_graphics("transChooser1.png")
```

\newpage

# Petrels

\vspace{-3pt}

[Croxall (1982)](http://www.jstor.org/stable/4318?seq=1#page_scan_tab_contents) examined the weight loss of adult petrels during periods of egg incubation.  He examined 13 species but some had measurements for both sexes such that 19 measurements are found in `Petrels.csv`.  For each measurement the mean initial weight (g) and mean weight lost (g/g/d) were recorded.  Determine if the mean initial weight significant explains variability in mean weight lost.

```{r}
petrels <- read.csv("Petrels.csv")
str(petrels)
```


## Analysis

\vspace{-3pt}

```{r par1=TRUE}
lm1 <- lm(weight.loss~weight,data=petrels)
fitPlot(lm1,xlab="Weight (g)",ylab="Weight Loss (g/g/d)")
```
```{r eval=FALSE}
transChooser(lm1)
```

\vspace{-8pt}

```{r echo=FALSE, out.width='5.66in'}
knitr::include_graphics("transChooser2.png")
```

```{r echo=FALSE, out.width='5.65in'}
knitr::include_graphics("transChooser3.png")
```

```{r echo=FALSE, out.width='5.65in'}
knitr::include_graphics("transChooser4.png")
```

```{r par1=TRUE, out.width='2.35in'}
petrels$log.wt <- log(petrels$weight)
petrels$log.wtloss <- log(petrels$weight.loss)
lm2 <- lm(log.wtloss~log.wt,data=petrels)
fitPlot(lm2,xlab="log Weight (g)",ylab="log Weight Loss (g/g/d)")
```

```{r}
anova(lm2)
summary(lm2)
confint(lm2)
( p.log.wtloss <- predict(lm2,data.frame(log.wt=log(5000)),
                          interval="confidence") )
exp(p.log.wtloss)*exp(anova(lm2)[2,3]/2)
```

```{r echo=FALSE, results="hide", message=FALSE, warnings=FALSE}
purl2("RHO.Rmd",moreItems=c("source","modHTML","Renders",
                            "knitr::include","DELETE"))
```
