---
layout: page
title: "IVR Lecture"
author: Derek H. Ogle
css: "/css/modules.css"
---


<hr />
<div id="background" class="section level2">
<h2>Background</h2>
<p><a href="https://www.researchgate.net/profile/Kyle_Hartman/publication/250019672_Estimating_Energy_Density_of_Fish/links/0a85e52e51c7c8df25000000.pdf">Hartman and Brandt (1995)</a> examined the relationship between energy density (J/g wet weight) and percent dry weight for four species – Bay Anchovy (<em>Anchoa mitchilli</em>), Bluefish (<em>Pomatomus saltatrix</em>), Striped Bass (<em>Morone saxatilis</em>), and Weakfish (<em>Cynoscion regalis</em>). Their primary interest was to determine how energy density was related to percent dry weight and if the relationship differed among species. The recorded energy density values were converted from J/g to kJ/g to better represent significant digits.</p>
<pre class="r"><code>&gt; options(show.signif.stars=FALSE)
&gt; library(NCStats)
&gt; FED &lt;- read.csv(&quot;https://raw.githubusercontent.com/droglenc/NCData/master/FishEnergyDensity.csv&quot;)
&gt; FED$ed2 &lt;- FED$ed/1000
&gt; str(FED)</code></pre>
<pre><code>&#39;data.frame&#39;:   64 obs. of  4 variables:
 $ species: Factor w/ 4 levels &quot;bayanchovy&quot;,&quot;bluefish&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
 $ dw     : int  39 34 34 32 31 30 30 29 26 25 ...
 $ ed     : int  10000 9000 8500 8100 7500 7100 7700 6100 5900 5500 ...
 $ ed2    : num  10 9 8.5 8.1 7.5 7.1 7.7 6.1 5.9 5.5 ...</code></pre>
<pre class="r"><code>&gt; levels(FED$species)</code></pre>
<pre><code>[1] &quot;bayanchovy&quot;  &quot;bluefish&quot;    &quot;stripedbass&quot; &quot;weakfish&quot;   </code></pre>
<p>This represents an indicator variable regression because the response variable (energy density) is quantitative and there is a quantitative explanatory variable (dry weight), which is called a covariate, and a categorical explanatory variable (species).</p>
<div class="alert alert-info">
<ul>
<li>
The concept of an indicator variable regression was described in <a href="https://vimeo.com/398994393">this video</a>.
</li>
</ul>
</div>
<p><br></p>
</div>
<div id="model-setups" class="section level2">
<h2>Model Setups</h2>
<p>Three indicator variables are required to represent the four species.</p>
<ul>
<li>BF=1 if Bluefish, =0 otherwise</li>
<li>SB=1 if Striped Bass, =0 otherwise</li>
<li>WF=1 if Weakfish, =0 otherwise</li>
</ul>
<p>With this, Bay Anchovy are the reference group.</p>
<div class="alert alert-info">
<ul>
<li>
Constructing indicator variables was described in <a href="https://vimeo.com/399006140">this video</a>.
</li>
</ul>
</div>
<p>The ultimate full model is</p>
<ul>
<li>μ<sub>ED</sub> = α + βDW + δ<sub>1</sub>BF + δ<sub>2</sub>SB + δ<sub>3</sub>WF + γ<sub>1</sub>BF×DW + γ<sub>2</sub>SB×DW + γ<sub>3</sub>WF×DW,</li>
</ul>
<p>where ED is energy density and DW is dry weight. The corresponding submodels are</p>
<ul>
<li>Bay Anchovy: μ<sub>ED</sub> = α + βDW</li>
<li>Bluefish: μ<sub>ED</sub> = (α+δ<sub>1</sub>) + (β+γ<sub>1</sub>)DW</li>
<li>Striped Bass: μ<sub>ED</sub> = (α+δ<sub>2</sub>) + (β+γ<sub>2</sub>)DW</li>
<li>Weakfish: μ<sub>ED</sub> = (α+δ<sub>3</sub>) + (β+γ<sub>3</sub>)DW</li>
</ul>
<p>The ultimate full model is fit in R with</p>
<pre class="r"><code>&gt; lm1 &lt;- lm(ed2~dw*species,data=FED)</code></pre>
<p>A quick check of assumptions suggests that they are all met as the residual plot shows no curvature or funneling, the Anderson-Darling p-value indicates normality, and the outlier test p-value indicates no outliers.</p>
<pre class="r"><code>&gt; transChooser(lm1)</code></pre>
<p><img src="Lecture_IVR_NRGDensity_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The model parameters have the following meanings:</p>
<ul>
<li>α is the intercept for Bay Anchovy (reference group).</li>
<li>β is the slope for Bay Anchovy (reference group).</li>
<li>δ<sub>1</sub> is the difference in intercept of Bluefish and Bay Anchovy</li>
<li>δ<sub>2</sub> is the difference in intercept of Striped Bass and Bay Anchovy</li>
<li>δ<sub>3</sub> is the difference in intercept of Weakfish and Bay Anchovy</li>
<li>γ<sub>1</sub> is the difference in slopes of Bluefish and Bay Anchovy</li>
<li>γ<sub>2</sub> is the difference in slopes of Striped Bass and Bay Anchovy</li>
<li>γ<sub>3</sub> is the difference in slopes of Weakfish and Bay Anchovy</li>
</ul>
<p>Estimates (and 95% CIs) of the model parameters are obtained with</p>
<pre class="r"><code>&gt; cbind(Ests=coef(lm1),confint(lm1))</code></pre>
<pre><code>                            Ests       2.5 %     97.5 %
(Intercept)            0.7027509 -0.42063764  1.8261395
dw                     0.1541905  0.10223406  0.2061469
speciesbluefish       -4.4402509 -5.96844344 -2.9120584
speciesstripedbass    -2.3783415 -3.86110640 -0.8955765
speciesweakfish       -2.3960056 -3.85760797 -0.9344031
dw:speciesbluefish     0.2083095  0.14562788  0.2709912
dw:speciesstripedbass  0.1576205  0.09429774  0.2209434
dw:speciesweakfish     0.1496038  0.08320906  0.2159985</code></pre>
<div class="alert alert-info">
<ul>
<li>
Constructing the ultimate full model and submodels, descriptions of the meanings of the parameters, and the R code were described in <a href="https://vimeo.com/398994239">this video</a>.
</li>
</ul>
</div>
<p><br></p>
</div>
<div id="parallel-lines-test" class="section level2">
<h2>Parallel Lines Test</h2>
<p>The hypothese (and, thus, models) for the parallel lines test are as follows:</p>
<ul>
<li>H<sub>0</sub>: μ<sub>ED</sub> = α + βDW + δ<sub>1</sub>BF + δ<sub>2</sub>SB + δ<sub>3</sub>WF</li>
<li>H<sub>A</sub>: μ<sub>ED</sub> = α + βDW + δ<sub>1</sub>BF + δ<sub>2</sub>SB + δ<sub>3</sub>WF + γ<sub>1</sub>BF×DW + γ<sub>2</sub>SB×DW + γ<sub>3</sub>WF×DW</li>
</ul>
<p>The ANOVA table for conducting the parallel lines test is below</p>
<pre class="r"><code>&gt; anova(lm1)</code></pre>
<pre><code>Analysis of Variance Table

Response: ed2
           Df  Sum Sq Mean Sq  F value    Pr(&gt;F)
dw          1 170.693 170.693 1858.966 &lt; 2.2e-16
species     3  10.592   3.531   38.452 1.258e-13
dw:species  3   4.106   1.369   14.904 3.002e-07
Residuals  56   5.142   0.092                   </code></pre>
<p>The p-value for the interaction term (p&lt;0.00005; i.e., last p-value in table above) is clearly less than α indicating that H<sub>0</sub> should be rejected. This result indicates that the slopes for the regressions between energy density and dry weight differ among species and, thus, the relationship between energy density and dry weight differs among the species.</p>
<div class="alert alert-info">
<ul>
<li>
Parallel lines tests were described in <a href="https://vimeo.com/398994330">this video</a>.
</li>
</ul>
</div>
<div class="alert alert-warning">
<ul>
<li>
To this point was largely review from previous materials
</li>
</ul>
</div>
<p>The parallel lines test indicates SOME difference in slopes between the species, but not specifically which species’ slopes are different. The following video explains what we should do to identify the specific differences.</p>
<iframe src="https://player.vimeo.com/video/399210843" width="640" height="480" frameborder="0" allow="autoplay; fullscreen" allowfullscreen>
</iframe>
<p>The <code>compSlopes()</code> results below were shown in the video.</p>
<pre class="r"><code>&gt; compSlopes(lm1)</code></pre>
<pre><code>Multiple Slope Comparisons (using the &#39;holm&#39; adjustment)</code></pre>
<pre><code>              comparison     diff  95% LCI  95% UCI p.unadj   p.adj
1    bluefish-bayanchovy  0.20831  0.14563  0.27099 0.00000 0.00000
2 stripedbass-bayanchovy  0.15762  0.09430  0.22094 0.00001 0.00005
3    weakfish-bayanchovy  0.14960  0.08321  0.21600 0.00003 0.00012
4   stripedbass-bluefish -0.05069 -0.10109 -0.00029 0.04873 0.10290
5      weakfish-bluefish -0.05871 -0.11291 -0.00450 0.03430 0.10290
6   weakfish-stripedbass -0.00802 -0.06296  0.04693 0.77116 0.77116</code></pre>
<pre><code>
Slope Information (using the &#39;holm&#39; adjustment)</code></pre>
<pre><code>        level  slopes 95% LCI 95% UCI p.unadj p.adj
1  bayanchovy 0.15419 0.10223 0.20615       0     0
4    weakfish 0.30379 0.26246 0.34513       0     0
3 stripedbass 0.31181 0.27561 0.34801       0     0
2    bluefish 0.36250 0.32744 0.39756       0     0</code></pre>
<p>As discussed in the video, these results show that the slope for Bay Anchovy differs from the slopes for the other three species (top three p-values) but that the slopes for the other three species are not different (bottom three p-values). The first three <code>diff</code>erences in the top portion of the results suggest that the slope for Bay Anchovy is less than the slopes for the other three species. The slopes and confidence intervals in the bottom portion of the results also suggest that the slope for Bay Anchovy is less than the slope for the other three species.</p>
<p>These results are illustrated in the following fitted-line plot.</p>
<pre class="r"><code>&gt; fitPlot(lm1,xlab=&quot;% Dry Weight&quot;,ylab=&quot;Energy Density (kJ/g)&quot;,
+         legend=&quot;topleft&quot;,cex.leg=0.8)</code></pre>
<p><img src="Lecture_IVR_NRGDensity_files/figure-html/unnamed-chunk-10-1.png" width="336" /></p>
<p><br></p>
</div>
<div id="equal-intercepts-coincident-lines-test" class="section level2">
<h2>Equal Intercepts (Coincident Lines) Test</h2>
<p>For the three species above that had the same slope it is useful to also determine if they have the same intercepts or not. If they have the same intercepts (and the same slopes) then they can be modeled with the same line (or the lines would be called coincident).</p>
<p>To begin this analysis I reduced the data frame to just these three species (by eliminating Bay Anchovy), fit the ultimate full model to just these species, reaffirmed that they have the same slopes (i.e., examine the parallel lines test for just these three species), and determined if they have the same intercept or not.</p>
<pre class="r"><code>&gt; FED1 &lt;- filterD(FED,species!=&quot;bayanchovy&quot;)
&gt; lm2 &lt;- lm(ed2~dw*species,data=FED1)
&gt; anova(lm2)</code></pre>
<pre><code>Analysis of Variance Table

Response: ed2
           Df  Sum Sq Mean Sq  F value    Pr(&gt;F)
dw          1 104.963 104.963 838.6208 &lt; 2.2e-16
species     2   2.584   1.292  10.3210 0.0003476
dw:species  2   0.556   0.278   2.2225 0.1247887
Residuals  32   4.005   0.125                   </code></pre>
<p>The interaction (bottom) p-value does reaffirm that these three species have the same slope (and are, thus, parallel). Given that the lines are parallel it is possible then to perform the equal intercepts test. The hypotheses for equal intercepts test are</p>
<ul>
<li>H<sub>0</sub>: μ<sub>ED</sub> = α + βDW</li>
<li>H<sub>A</sub>: μ<sub>ED</sub> = α + βDW + δ<sub>1</sub>SB + δ<sub>2</sub>WF</li>
</ul>
<div class="alert alert-info">
<ul>
<li>
Equal intercepts tests were described in <a href="https://vimeo.com/398994330">this video</a>.
</li>
</ul>
</div>
<p>The p-value for the factor variable (p=0.0003; i.e., the second line) is less than α and, thus, the H<sub>0</sub> for the equal intercepts test is rejected. Thus, there is a difference in intercepts among these three species. The following video explains what we should do to indentify which pairs of intercepts are different.</p>
<iframe src="https://player.vimeo.com/video/399283122" width="640" height="480" frameborder="0" allow="autoplay; fullscreen" allowfullscreen>
</iframe>
<p>The results of <code>compIntercepts()</code> below were shown in the video.</p>
<pre class="r"><code>&gt; compIntercepts(lm2,common.cov=0)</code></pre>
<pre><code>Warning: Removed an interaction term from &#39;mdl&#39; (i.e., assumed
 parallel lines) to test intercepts.</code></pre>
<pre><code>Tukey HSD on means adjusted assuming parallel lines</code></pre>
<pre><code>            comparison       diff    95% LCI   95% UCI        p.adj
1 stripedbass-bluefish  0.6313980  0.2911082 0.9716878 0.0001843341
2    weakfish-bluefish  0.5064749  0.1445318 0.8684180 0.0044160914
3 weakfish-stripedbass -0.1249231 -0.4808922 0.2310461 0.6693967026</code></pre>
<pre><code>
Mean ed2 when dw=0</code></pre>
<pre><code>   bluefish stripedbass    weakfish 
  -2.752451   -2.121053   -2.245976 </code></pre>
<p>The top of this output shows that the intercept for Bluefish differs from the intercepts for the other two species (top two p-values), which do not differ (bottom p-value). The bottom of this output shows the estimated intercepts for the three species. This bottom output is not particularly interesting because it shows the mean energy density when the percent dry weight is 0 (because <code>common.cov=0</code>), which is not useful.</p>
<p>If the <code>common.cov=0</code> argument is removed then <code>compIntercepts()</code> will show the mean energy density at the mean percent dry weight, which is more useful. Given that the lines are parallel, differences at any value of X will be the same as when X=0. Thus, the top portion of the output did not change.</p>
<pre class="r"><code>&gt; compIntercepts(lm2)</code></pre>
<pre><code>Warning: Removed an interaction term from &#39;mdl&#39; (i.e., assumed
 parallel lines) to test intercepts.</code></pre>
<pre><code>Tukey HSD on means adjusted assuming parallel lines</code></pre>
<pre><code>            comparison       diff    95% LCI   95% UCI        p.adj
1 stripedbass-bluefish  0.6313980  0.2911082 0.9716878 0.0001843341
2    weakfish-bluefish  0.5064749  0.1445318 0.8684180 0.0044160914
3 weakfish-stripedbass -0.1249231 -0.4808922 0.2310461 0.6693967026</code></pre>
<pre><code>
Mean ed2 when dw=26.10526</code></pre>
<pre><code>   bluefish stripedbass    weakfish 
   5.828663    6.460061    6.335138 </code></pre>
<p>These results are visualized with the following fitted line plot.</p>
<pre class="r"><code>&gt; fitPlot(lm2,xlab=&quot;Dry Weight&quot;,ylab=&quot;Energy Density (kJ/g)&quot;,
+         legend=&quot;topleft&quot;,cex.leg=0.8)</code></pre>
<p><img src="Lecture_IVR_NRGDensity_files/figure-html/unnamed-chunk-14-1.png" width="336" /></p>
</div>
<div id="relationships-test" class="section level2">
<h2>Relationships Test</h2>
<p>Finally, it should be noted that the top p-values in the ANOVA table when the lines are parallel is the so-called “relationships test.” Specifically, it tests whether a relationshiph exists between the response variable and the covariate. It should only examined if the lines are parallel because when the lines are parallel then the relationship between the response variable and the covariate differs depending on the group being examined.</p>
<p>The ANOVA table above clearly shows that there is a relationship between the energy density of the fish and the percent dry weight.</p>
<hr />
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
