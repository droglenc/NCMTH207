---
title: "Indicator Variable Regression"
subtitle: R Handout
author: "Derek H. Ogle"
layout: page
css: /css/modules.css
output:
  pdf_document:
    fig_height: 3
    fig_width: 3
  html_document:
    fig_height: 3
    fig_width: 3
    self_contained: no
---

```{r echo=FALSE, eval=FALSE}
# Renders an appropriate HTML file for the webpage
source("C:/aaaWork/Web/GitHub/NCMTH207/rhelpers/rhelpers.R")
setwd("C:/aaaWork/Web/GitHub/NCMTH207/modules/IVRegression") ## DELETE
modHTML("RHO")
```
```{r echo=FALSE, results='hide', message='FALSE'}
source("C:/aaaWork/Web/GitHub/NCMTH207/rhelpers/knitr_setup.R")
```

\vspace{-18pt}

----

\vspace{-18pt}

## Initialization

\vspace{-6pt}

```{r results='hide', message=FALSE, warning=FALSE}
library(NCStats)
setwd("C:/aaaWork/Web/GitHub/NCMTH207/modules/IVRegression")
```

\vspace{-6pt}

----

\vspace{-15pt}

# Salmon Sperm Example

\vspace{-9pt}

## Background

\vspace{-6pt}

[Vladic *et al.* (2002)](http://www.biolreprod.org/content/66/1/98.long) recorded (in `SalmonSperm.csv`) the probability of successful egg fertilization (`fert.success`) and the length of sperm tail end piece (`step.len`).  They asked "Are fertilization success and length of sperm related and does that relationship differ between adult and parr salmon?"

```{r}
ss <- read.csv("SalmonSperm.csv")[-c(1,10,11),]  # only for class demo purposes
str(ss)
xlbl <- "Sperm Tail End Piece Length (um)"
ylbl <- "Fertilization Success"
```

\vspace{-6pt}

## Fitting the Linear Model

\vspace{-6pt}

```{r fig.width=6, par1=TRUE}
lm1 <- lm(fert.succ~step.len*mat,data=ss)
```
```{r eval=FALSE}
transChooser(lm1)
```
```{r echo=FALSE, out.width='6in'}
knitr::include_graphics("transChooser1.png")
```

## Model Exploration and Summarization
```{r message=FALSE, par1=TRUE}
summary(lm1)
confint(lm1)
fitPlot(lm1,interval="confidence",xlab=xlbl,ylab=ylbl,legend="topleft")
( nd <- data.frame(step.len=c(3.4,3.7),mat=c("Adult","Parr")) )
predictionPlot(lm1,nd,interval="confidence",legend="topleft")
```


\vspace{24pt}

## Lecture Support -- ANOVA Demonstration
```{r results="hide"}
lm1 <- lm(fert.succ~step.len*mat,data=ss)
anova(lm1)
```
```{r echo=FALSE}
tmp <- anova(lm1)
attr(tmp,"heading") <- NULL
tmp
```

\vspace{12pt}

```{r results="hide"}
lm2 <- lm(fert.succ~step.len+mat,data=ss)
anova(lm2)
```
```{r echo=FALSE}
tmp <- anova(lm2)
attr(tmp,"heading") <- NULL
tmp
```

\vspace{12pt}

```{r results="hide"}
lm3 <- lm(fert.succ~step.len,data=ss)
anova(lm3)
```
```{r echo=FALSE}
tmp <- anova(lm3)
attr(tmp,"heading") <- NULL
tmp
```


# Fish Energy Density Example
## Background
[Hartman and Brandt (1995)](http://www.tandfonline.com/doi/abs/10.1577/1548-8659%281995%29124%3C0347%3AEEDOF%3E2.3.CO%3B2) examined the relationship between energy density and percent dry weight for four species of fish -- Bay Ancovy (*Anchoa mitchilli*), Bluefish (*Pomatomus saltatrix*), Striped Bass (*Morone saxatilis*), and Weakfish (*Cynoscion regalis*).  They wanted to describe the relationship between these two variables and determine if there were any differences among species.

```{r}
FED <- read.csv("FishEnergyDensity.csv")
str(FED)
```

## Model Fitting and Analysis
```{r fig.width=6, par1=TRUE}
lm1 <- lm(ed~dw*species,data=FED)
```

```{r eval=FALSE}
transChooser(lm1)
```
```{r echo=FALSE, out.width='6in'}
knitr::include_graphics("transChooser2.png")
```

```{r}
anova(lm1)
```

\newpage

```{r par1=TRUE}
compSlopes(lm1)
fitPlot(lm1,xlab="Dry Weight",ylab="Energy Density",legend="topleft")
```

## Follow-Up Model Fitting and Analysis

```{r results="hide"}
FED1 <- filterD(FED,species!="bayanchovy")
lm2 <- lm(ed~dw*species,data=FED1)
anova(lm2)
```
```{r echo=FALSE}
tmp <- anova(lm2)
attr(tmp,"heading") <- NULL
tmp
```

```{r par1=TRUE}
compIntercepts(lm2)
compIntercepts(lm2,common.cov=0)
fitPlot(lm2,xlab="Dry Weight",ylab="Energy Density",legend="topleft")
```


```{r echo=FALSE, results="hide", message=FALSE, warnings=FALSE}
purl2("RHO.Rmd",moreItems=c("source","modHTML","Renders",
                            "knitr::include","DELETE"))
```
